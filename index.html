<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Trumpo Arena Battle</title>
  <!-- ‚úÖ Pixel Font -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      font-family: 'Press Start 2P', cursive;
      color: white;
      background: url("bg.png") no-repeat center center fixed; /* ‚úÖ Adjusted background to top */
      background-size: cover;
    }

    #home, #gameContainer {
      text-align: center;
    }

    h1 {
      font-size: 28px;
      color: yellow;
      text-shadow: 2px 2px 0 black;
      margin-bottom: 20px;
    }

    button {
      padding: 12px 24px;
      font-size: 14px;
      border: none;
      background: #ff4444;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      margin: 10px;
      font-family: 'Press Start 2P', cursive;
    }
    button:hover { background: #ff6666; }

    #arena { border-radius: 50%; background: transparent; }

    #result {
      position: absolute;
      top: 20px;
      font-size: 16px;
      text-align: center;
      width: 100%;
      color: yellow;
      font-weight: bold;
      display: none;
      text-shadow: 2px 2px 0 black;
    }

    #restart {
      position: absolute;
      top: 10%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 10px 20px;
      font-size: 12px;
      border: none;
      background: #ff4444;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      display: none;
      font-family: 'Press Start 2P', cursive;
    }
    #restart:hover { background: #ff6666; }

    /* ‚úÖ Modal Overlay */
    #instructionModal {
      display: none;
      position: fixed;
      z-index: 999;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.8);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: #222;
      border: 4px solid #fff;
      box-shadow: 0 0 10px #ff4444, 0 0 20px #ff4444 inset;
      padding: 20px;
      text-align: left;
      max-width: 500px;
      width: 90%;
      font-size: 12px;
      line-height: 1.6;
      color: #ffeb3b;
    }

    .modal-content h2 {
      font-size: 14px;
      margin-bottom: 15px;
      text-align: center;
      color: #ff4444;
      text-shadow: 2px 2px 0 black;
    }

    .closeBtn {
      display: block;
      margin: 20px auto 0;
      padding: 8px 16px;
      background: #ff4444;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 12px;
      font-family: 'Press Start 2P', cursive;
    }
    .closeBtn:hover { background: #ff6666; }

    /* ‚úÖ Countdown Overlay */
    #countdown {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      font-size: 64px;
      font-family: 'Press Start 2P', cursive;
      color: yellow;
      text-shadow: 4px 4px 0 black;
      display: none;
      z-index: 1000;
      animation: pop 1s ease-in-out;
    }

    @keyframes pop {
      0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
      50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
    }

    /* ‚úÖ Skill HUD */
    #skillDisplay {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      justify-content: space-between;
      width: 500px;
      font-size: 10px;
    }
    .playerSkills { display: flex; flex-direction: column; gap: 6px; }
    .skill {
      width: 100px; height: 14px;
      border: 2px solid white;
      position: relative;
      background: rgba(0,0,0,0.5);
    }
    .skill span {
      position: absolute; left: 50%; top: 50%;
      transform: translate(-50%, -50%);
      font-size: 8px; color: white;
    }
    .cooldown {
      position: absolute; left: 0; top: 0;
      height: 100%; background: rgba(255,0,0,0.6);
      width: 0%; transition: width 0.2s linear;
    }
  </style>
</head>
<body>
  <!-- ‚úÖ Home Page -->
  <div id="home">
    <h1>TRUMPO ARENA BATTLE</h1>
    <button id="startBtn">START GAME</button>
    <button id="instructionBtn">INSTRUCTIONS</button>
  </div>

  <!-- ‚úÖ Game Container -->
  <div id="gameContainer" style="display:none; position:relative;">
    <canvas id="arena" width="600" height="600"></canvas>
    <div id="result"></div>
    <button id="restart">Restart</button>
    <div id="countdown"></div>

    <!-- ‚úÖ Skill Display HUD -->
    <div id="skillDisplay">
      <div class="playerSkills" id="redSkills">
        <div class="skill"><div class="cooldown" id="redDashCD"></div><span>Dash</span></div>
        <div class="skill"><div class="cooldown" id="redShieldCD"></div><span>Shield</span></div>
        <div class="skill"><div class="cooldown" id="redUltCD"></div><span>Ultimate</span></div>
      </div>
      <div class="playerSkills" id="blueSkills">
        <div class="skill"><div class="cooldown" id="blueDashCD"></div><span>Dash</span></div>
        <div class="skill"><div class="cooldown" id="blueShieldCD"></div><span>Shield</span></div>
        <div class="skill"><div class="cooldown" id="blueUltCD"></div><span>Ultimate</span></div>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Modal -->
  <div id="instructionModal">
    <div class="modal-content">
      <h2>üéÆ INSTRUCTIONS</h2>
      <p>- <span style="color:red;">Red Player</span>: Move = WASD<br>
         Dash = Shift, Shield = F, Ultimate = G</p>
      <p>- <span style="color:cyan;">Blue Player</span>: Move = Arrow Keys<br>
         Dash = /, Shield = Enter, Ultimate = .</p>
      <p>‚öîÔ∏è Knock your opponent‚Äôs health to 0 to win!</p>
      <button class="closeBtn">CLOSE</button>
    </div>
  </div>

  <script>
    const home = document.getElementById("home");
    const gameContainer = document.getElementById("gameContainer");
    const startBtn = document.getElementById("startBtn");
    const instructionBtn = document.getElementById("instructionBtn");
    const instructionModal = document.getElementById("instructionModal");
    const closeBtn = document.querySelector(".closeBtn");
    const countdownEl = document.getElementById("countdown");

    startBtn.addEventListener("click", () => {
      home.style.display = "none";
      gameContainer.style.display = "block";
      startGame();
    });
    instructionBtn.addEventListener("click", () => instructionModal.style.display = "flex");
    closeBtn.addEventListener("click", () => instructionModal.style.display = "none");

    function startGame() {
      const canvas = document.getElementById('arena');
      const ctx = canvas.getContext('2d');
      const result = document.getElementById('result');
      const restartBtn = document.getElementById('restart');

      const arenaCenter = { x: canvas.width / 2, y: canvas.height / 2 };
      const arenaRadius = canvas.width / 2 - 20;

      const redImg = new Image(); redImg.src = "red.png";
      const blueImg = new Image(); blueImg.src = "blue.png";

      // ‚úÖ Load skill effect images
      const shieldImg = new Image(); shieldImg.src = "shield.gif";
      const tornadoImg = new Image(); tornadoImg.src = "tord.png";
      const dashImg = new Image(); dashImg.src = "dash.png";

      // üîπ Pixel Spark effect
      let sparks = [];
      function createSparks(x, y, color) {
        for (let i = 0; i < 8; i++) {
          sparks.push({
            x, y,
            dx: (Math.random() - 0.5) * 6,
            dy: (Math.random() - 0.5) * 6,
            life: 20,
            color
          });
        }
      }
      function drawSparks(ctx) {
        sparks.forEach((s, i) => {
          ctx.fillStyle = s.color;
          ctx.globalAlpha = s.life / 20;
          ctx.fillRect(s.x, s.y, 3, 3); // ‚úÖ pixel sparks
          ctx.globalAlpha = 1.0;
          s.x += s.dx;
          s.y += s.dy;
          s.life--;
          if (s.life <= 0) sparks.splice(i, 1);
        });
      }

      class Beyblade {
        constructor(x, y, color, img, controls, dashKey, shieldKey, ultimateKey, prefix) {
          this.x = x; this.y = y; this.color = color; this.img = img;
          this.radius = 50; this.health = 100; this.speed = 3;
          this.controls = controls; this.dashKey = dashKey;
          this.shieldKey = shieldKey; this.ultimateKey = ultimateKey;
          this.dx = 0; this.dy = 0;
          this.dashActive = false; this.shieldActive = false; this.ultimateActive = false;
          this.dashCooldown = false; this.shieldCooldown = false;
          this.ultimateCharge = 0;
          this.trail = [];
          this.prefix = prefix; // ‚úÖ for HUD link
        }
        move(keys) {
          this.dy = keys[this.controls.up] ? -this.speed : keys[this.controls.down] ? this.speed : 0;
          this.dx = keys[this.controls.left] ? -this.speed : keys[this.controls.right] ? this.speed : 0;
          this.x += this.dx; this.y += this.dy;
          const dx = this.x - arenaCenter.x, dy = this.y - arenaCenter.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          if (dist + this.radius > arenaRadius) {
            const angle = Math.atan2(dy, dx);
            this.x = arenaCenter.x + Math.cos(angle) * (arenaRadius - this.radius);
            this.y = arenaCenter.y + Math.sin(angle) * (arenaRadius - this.radius);
          }
          if (keys[this.dashKey] && !this.dashActive && !this.dashCooldown) this.activateDash();
          if (keys[this.shieldKey] && !this.shieldActive && !this.shieldCooldown) this.activateShield();
          if (keys[this.ultimateKey] && this.ultimateCharge >= 100 && !this.ultimateActive) this.activateUltimate();
        }
        activateDash() {
          this.dashActive = true; this.dashCooldown = true;
          const angle = Math.atan2(this.dy, this.dx) || Math.random() * Math.PI * 2;
          this.x += Math.cos(angle) * 80; this.y += Math.sin(angle) * 80;
          this.trail.push({x: this.x, y: this.y, life: 15});
          setTimeout(() => this.dashActive = false, 300);
          setTimeout(() => this.dashCooldown = false, 4000);
        }
        activateShield() {
          this.shieldActive = true; this.shieldCooldown = true;
          setTimeout(() => this.shieldActive = false, 2000);
          setTimeout(() => this.shieldCooldown = false, 6000);
        }
        activateUltimate() {
          this.ultimateActive = true; this.ultimateCharge = 0;
          setTimeout(() => this.ultimateActive = false, 3000);
        }
        draw() {
          // üîπ Dash trail
          this.trail.forEach((t, i) => {
            ctx.globalAlpha = t.life / 15;
            ctx.drawImage(dashImg, t.x - 30, t.y - 30, 60, 60);
            ctx.globalAlpha = 1.0;
            t.life--;
            if (t.life <= 0) this.trail.splice(i, 1);
          });

          // üîπ Beyblade sprite
          ctx.drawImage(this.img, this.x - this.radius, this.y - this.radius, this.radius * 2, this.radius * 2);

          // üîπ Shield
          if (this.shieldActive) {
            ctx.save();
            ctx.globalAlpha = 0.7;
            ctx.drawImage(shieldImg, this.x - this.radius*1.3, this.y - this.radius*1.6, this.radius*2.5, this.radius*2.5);
            ctx.restore();
          }

          // üîπ Ultimate
          if (this.ultimateActive) {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.globalAlpha = 0.7;
            ctx.drawImage(tornadoImg, -this.radius*2.4, -this.radius*2.3, this.radius*5, this.radius*5);
            ctx.restore();
          }

          // üîπ Health + charge bars
          ctx.fillStyle = "red"; ctx.fillRect(this.x - 25, this.y - 40, 50, 5);
          ctx.fillStyle = "lime"; ctx.fillRect(this.x - 25, this.y - 40, (this.health / 100) * 50, 5);
          ctx.fillStyle = "gray"; ctx.fillRect(this.x - 25, this.y + 35, 50, 5);
          ctx.fillStyle = "gold"; ctx.fillRect(this.x - 25, this.y + 35, (this.ultimateCharge / 100) * 50, 5);

          // ‚úÖ Update HUD bars
          document.getElementById(this.prefix+"DashCD").style.width = this.dashCooldown ? "100%" : "0%";
          document.getElementById(this.prefix+"ShieldCD").style.width = this.shieldCooldown ? "100%" : "0%";
          document.getElementById(this.prefix+"UltCD").style.width = this.ultimateCharge < 100 ? "100%" : "0%";
        }
      }

      const bey1 = new Beyblade(250, 300, "red", redImg,
        { up: "w", down: "s", left: "a", right: "d" }, "shift", "f", "g", "red");
      const bey2 = new Beyblade(350, 300, "blue", blueImg,
        { up: "arrowup", down: "arrowdown", left: "arrowleft", right: "arrowright" }, "/", "enter", ".", "blue");

      let keys = {};
      document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
      document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

      function detectCollision(b1, b2) {
        const dx = b1.x - b2.x, dy = b1.y - b2.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < b1.radius + b2.radius) {
          if (!b1.shieldActive) b1.health -= b2.dashActive ? 2 : 0.5;
          if (!b2.shieldActive) b2.health -= b1.dashActive ? 2 : 0.5;
          b1.ultimateCharge = Math.min(100, b1.ultimateCharge + 2);
          b2.ultimateCharge = Math.min(100, b2.ultimateCharge + 2);
          const angle = Math.atan2(dy, dx), push = 2;
          b1.x += Math.cos(angle) * push; b1.y += Math.sin(angle) * push;
          b2.x -= Math.cos(angle) * push; b2.y -= Math.sin(angle) * push;
          createSparks((b1.x + b2.x) / 2, (b1.y + b2.y) / 2, "yellow");
        }
        const tornadoRange = 50;
        if (b1.ultimateActive && dist < tornadoRange) {
          b2.health -= 0.5;
          const angle = Math.atan2(b2.y - b1.y, b2.x - b1.x);
          b2.x -= Math.cos(angle) * 2;
          b2.y -= Math.sin(angle) * 2;
        }
        if (b2.ultimateActive && dist < tornadoRange) {
          b1.health -= 0.5;
          const angle = Math.atan2(b1.y - b2.y, b1.x - b2.x);
          b1.x -= Math.cos(angle) * 2;
          b1.y -= Math.sin(angle) * 2;
        }
      }

      let gameOver = false;
      function gameLoop() {
        if (gameOver) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawSparks(ctx);
        bey1.move(keys); bey2.move(keys); detectCollision(bey1, bey2);
        bey1.draw(); bey2.draw();
        if (bey1.health <= 0 || bey2.health <= 0) {
          gameOver = true;
          result.innerText = bey1.health > bey2.health ? "üî• Red Player Wins!" : "üíß Blue Player Wins!";
          result.style.display = "block"; restartBtn.style.display = "block";
        } else requestAnimationFrame(gameLoop);
      }

      restartBtn.addEventListener("click", () => {
        bey1.x = 250; bey1.y = 300; bey1.health = 100; bey1.ultimateCharge = 0;
        bey2.x = 350; bey2.y = 300; bey2.health = 100; bey2.ultimateCharge = 0;
        bey1.dashActive = bey2.dashActive = false;
        bey1.shieldActive = bey2.shieldActive = false;
        bey1.ultimateActive = bey2.ultimateActive = false;
        gameOver = false;
        result.style.display = "none"; restartBtn.style.display = "none";
        startCountdown(() => gameLoop());
      });

      function startCountdown(callback) {
        let count = 3;
        countdownEl.style.display = "block";
        countdownEl.innerText = count;
        const interval = setInterval(() => {
          count--;
          if (count > 0) countdownEl.innerText = count;
          else if (count === 0) countdownEl.innerText = "GO!";
          else {
            clearInterval(interval);
            countdownEl.style.display = "none";
            callback();
          }
        }, 1000);
      }

      startCountdown(() => gameLoop());
    }
  </script>
</body>
</html>
